id: org.telegram.desktop.webview
sdk: org.freedesktop.Sdk//21.08
runtime: org.telegram.desktop
runtime-version: stable
build-extension: true
appstream-compose: false
build-options:
  prefix: /app/lib/webview
  strip: true
cleanup:
  - /include
  - /lib/pkgconfig
  - /share/gir-1.0
modules:
  - name: webkitgtk
    buildsystem: cmake-ninja
    build-options:
      cflags: ''
      cflags-override: true
      cxxflags: ''
      cxxflags-override: true
      arch:
        x86_64:
          config-opts:
            - -DCMAKE_BUILD_TYPE=Release
        aarch64:
          config-opts:
            - -DCMAKE_BUILD_TYPE=MinSizeRel
    config-opts:
      - -DPORT=GTK
      - -DUSE_LIBNOTIFY=OFF
      - -DUSE_LIBSECRET=OFF
      - -DUSE_SOUP2=ON
      - -DUSE_WOFF2=OFF
      - -DUSE_WPE_RENDERER=OFF
      - -DENABLE_GAMEPAD=OFF
      - -DENABLE_SPELLCHECK=OFF
    sources:
      - type: archive
        url: https://webkitgtk.org/releases/webkitgtk-2.34.2.tar.xz
        sha256: 584677d6e7cae12e27cdcc8e05b4cf73b54849a24afc3d7a40cec91016deff00
        x-checker-data:
          type: html
          url: https://webkitgtk.org/releases/
          version-pattern: LATEST-STABLE-(\d[\.\d]+\d)
          url-template: https://webkitgtk.org/releases/webkitgtk-$version.tar.xz

  - name: metadata
    buildsystem: simple
    build-commands:
      - install -Dm644 -t ${FLATPAK_DEST}/share/metainfo ${FLATPAK_ID}.metainfo.xml
      - >-
        appstream-compose --origin=flatpak
        --basename=${FLATPAK_ID} --prefix=${FLATPAK_DEST} ${FLATPAK_ID}
    sources:
      - type: file
        path: org.telegram.desktop.webview.metainfo.xml
